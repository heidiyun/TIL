# docker-compose
2개 이상의 의존하는 컨테이너를 관리하는 기술

# Orchestration tool
## 배경
서버를 역할마다 분리하는 정책은 특정 서버에 컨테이너가 몰릴 수 있고, 역할이 모호한 애플리케이션의 경우 어디에 설치해야 할지 결정이 어렵다.
리소스가 여유있는 서버로 컨테이너를 옮기고 싶을 때, 다른 컨테이너와의 의존성 때문에 옮길 수 없는 경우도 있다.

컨테이너는 유연하여 확장이나 이동이 쉽다는 장점이 있는데 이런 장점을 활용하지 못하는 것은 매우 안타까운 일이다.

## Server Orchestration
> 여러 대의 서버와 여러 개의 서비스를 편리하게 관리해주는 작업  
> Scheduling, Clustering, Service Discovery, Logging, Monitoring  

1. Scheduling 
컨테이너를 적절한 서버에 배포해 주는 작업.
여러 대의 서버 중 가장 할일 없는 서버에 배포하거나 
순서대로 배포, 랜덤으로 배포 등..
컨테이너 개수를 여러 개로 늘리면 적당히 나눠서 배포하고 서버가 죽으면 실행 중이던 컨테이너를 다른 서버에 띄워주기도 한다.

2. Clustering
여러 개의 서버를 하나의 서버처럼 사용할 수 있다.
클러스터에 새로운 서버를 추가할 수도 있고 제거할 수도 있습니다.
흩어져 있는 컨테이너도 가상 네트워크를 이용하여 마치 같은 서버에 있는 것처럼 쉽게 통신할 수 있다.

3. Service Discovery
서비스를 찾아주는 기능
클러스터 환경에서 컨테이너는 어느 서버에 생성될지 알 수 없고 다른 서버로 이동할 수도 있다. 
컨테이너와 통신을 하기 위해서 어느 서버에서 실행중인지 알아야 하고 컨테이너가 생성되고 중지될 때 어딘가에 IP와 Port 등의 정보를 업데이트 해줘야 한다.

4. Logging, Monitoring
여러 개의 서버를 관리하는 경우 로그와 서버 상태를 한곳에서 관리하는게 좋다. 
오케스트레이션 툴은 서버를 중앙에서 관리한다.

### 단점
오케스트레이션 툴은 수백 수천만개의 서버를 관리하기 위한 목적으로 만들어졌기 때문에 설치 비용이 비싸며 관리도 어렵습니다.

## Docker Swarm
Docker에 모든 기능이 내장되어 있어 다른 tool을 설치할 필요가 없으며 docker 명령어를 그대로 사용할 수 있어 비교적 쉽고 편리하다.

node : swarm cluster에 속한 도커 서버의 단위.
	     보통 한 서버에 하나의 도커 데몬만 실행하므로 서버=노드 라고 생각하면 편하다.

Manager node : swarm cluster 상태를 관리하는 노드.
				swarm 명령어는 매니저 노드에서만 실행된다.
Worker node : 매니저 노드의 명령을 받아 컨테이너를 생성하고 상태를 체크한다.

Service : 기본적인 배포 단위.
		하나의 서비스는 하나의 이미지를 기반으로 생성하고 동일한 컨테이너를 한 개 이상 실행할 수 있다.


[Docker Swarm을 이용한 쉽고 빠른 분산 서버 관리](https://subicura.com/2017/02/25/container-orchestration-with-docker-swarm.html)

#node/정리목록